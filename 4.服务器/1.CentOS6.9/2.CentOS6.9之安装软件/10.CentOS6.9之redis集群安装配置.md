总操作流程：
- 1、下载安装
- 2、配置
- 3、测试

***

# 下载安装

>1、安装tcl

```shell
cd ~
cd /usr/local
tar xvfvz tcl8.6.1-src.tar.gz
mv tcl8.6.1 tcl
chown 777 tcl
cd tcl/unix
./configure 
make clean 
make
make install
tcl --version
```

>2、ruby安装
```shell
yum groupinstall "Development Tools"

cd ~
cd /usr/local
tar xvfvz ruby-2.6.3.tar.gz
mv ruby-2.6.3 ruby
cd ruby
./configure
make
sudo make install
ln -s /usr/local/ruby/ruby /usr/bin/ruby
ruby --version
```

>3、安装redis
```shell
cd ~
cd /usr/local
mkdir -p /usr/local/redis
chown 777 /usr/local/redis
tar xvfvz redis-5.0.5.tar.gz
mv  redis-5.0.5  redis1
#这里要将 redis1移到redis文件夹下
chown 777 /usr/local/redis/redis1
cd /usr/local/redis/redis1
```
- 修改配置
```shell
vim tests/integration/replication-2.tcl
```
- 将每个after后面的数据都加0，增大一位

```shell
cd src
sudo make clean 
sudo make
sudo make PREFIX=/usr/local/redis/redis1 install

cd ..
redis-server  redis.conf  #测试
```

# 配置

>1、创建配置目录
```shell
mkdir -p /usr/local/redis/{conf,data,logs,bin}
```
>2、复制集群工具
```shell
cp /usr/local/redis/redis1/src/redis-trib.rb /usr/local/redis/bin/
cd /usr/local/redis/bin/
chown 777 redis-trib.rb
```
>3、创建六台配置
```shell
cd /usr/local/redis/redis1/
cp redis.conf /usr/local/redis/conf/redis-6666.conf
cp redis.conf /usr/local/redis/conf/redis-6667.conf
cp redis.conf /usr/local/redis/conf/redis-6668.conf
cp redis.conf /usr/local/redis/conf/redis-6669.conf
cp redis.conf /usr/local/redis/conf/redis-6670.conf
cp redis.conf /usr/local/redis/conf/redis-6671.conf
```
>4、修改配置文件(六个配置都要修改)
```shell
cd /usr/local/redis/
vim redis-6666.conf # redis-6667.conf redis-6668.conf redis-6669.conf redis-6670.conf redis-6671.conf 修改一样
```
- 修改
```c
port 6666
daemonize yes
pidfile /usr/local/redis/data/redis_6666.pid
timeout 300
loglevel verbose
logfile /usr/local/redis/logs/redis_6666.log
dbfilename dump_6666.rdb
dir /usr/local/redis/data/ 
appendonly yes
appendfilename appendonly_6666.aof
no-appendfsync-on-rewrite yes
auto-aof-rewrite-percentage 80-100
```
- 添加

```c
unixsocket /usr/local/redis/data/redis_6666.sock
unixsocketperm 700
cluster-enabled yes
cluster-config-file /usr/local/redis/data/nodes_6666.conf 
cluster-node-timeout 5000 
```

>启动
```shell
cd /usr/local/redis/redis1/bin/
./redis-server /usr/local/redis/conf/redis-6666.conf 
./redis-server /usr/local/redis/conf/redis-6667.conf
./redis-server /usr/local/redis/conf/redis-6668.conf
./redis-server /usr/local/redis/conf/redis-6669.conf
./redis-server /usr/local/redis/conf/redis-6670.conf
./redis-server /usr/local/redis/conf/redis-6671.conf
```
>创建集群
```shell
cd /usr/local/redis/redis1/src

./redis-cli --cluster create 127.0.0.1:6666 127.0.0.1:6667 127.0.0.1:6668 127.0.0.1:6669 127.0.0.1:6670 127.0.0.1:6671
```

>开启防火墙
```shell
vim /etc/sysconfig/iptables
```

```shell
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6666 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6667 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6668 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6669 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6670 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6671 -j ACCEPT

```

```shell
service iptables restart #重启
```

# 测试
