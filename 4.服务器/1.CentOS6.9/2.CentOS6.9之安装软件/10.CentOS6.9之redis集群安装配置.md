总操作流程：
- 1、下载安装
- 2、配置
- 3、测试

***

# 下载安装

```shell
yum -y install gcc gcc-c++ autoconf automake libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5-devel libidn libidn-devel openssl openssl-devel nss_ldap openldap openldap-devel openldap-clients openldap-servers libxslt-devel libevent-devel ntp libtool-ltdl bison libtool vim-enhanced  readline-devel sqlite-devel
```

>1、ruby安装
```shell
yum groupinstall "Development Tools"
cd ~
cd /usr/local
tar xvfvz ruby-2.6.3.tar.gz
mv ruby-2.6.3 ruby
cd ruby
./configure
sudo make
sudo make install
ln -s /usr/local/ruby/ruby /usr/bin/ruby
ruby --version
```

>2、安装tcl
```shell
cd ~
cd /usr/local
tar xvfvz tcl8.6.9-src.tar.gz
mv tcl8.6.9 tcl
cd tcl/unix
./configure 
make && make install
```
- 这里报错：“/usr/local/tcl/unix/pkgs/thread2.7.0”不用管

>3、安装redis
```shell
cd ~
cd /usr/local
mkdir -p /usr/local/redis
chmod 0777 /usr/local/redis
tar xvfvz redis-5.0.5.tar.gz
mv  redis-5.0.5  perform
#这里要将 redis1移到redis文件夹下
chmod 0777 /usr/local/redis/perform
cd /usr/local/redis/perform/src
sudo make clean 
sudo make
sudo make PREFIX=/usr/local/redis/perform install
cd /usr/local/redis/perform
#启动测试
cd /usr/local/redis/perform/bin/
./redis-server /usr/local/redis/perform/redis.conf 
```

# 配置

>1、创建配置目录
```shell
mkdir -p /usr/local/redis/{conf,data,logs,bin}
cd /usr/local/redis/
chmod 0777 conf data logs bin
```
>2、创建六台配置
```shell
cd /usr/local/redis/perform/
cp redis.conf /usr/local/redis/conf/redis_6666.conf
cp redis.conf /usr/local/redis/conf/redis_6667.conf
cp redis.conf /usr/local/redis/conf/redis_6668.conf
cp redis.conf /usr/local/redis/conf/redis_6669.conf
cp redis.conf /usr/local/redis/conf/redis_6670.conf
cp redis.conf /usr/local/redis/conf/redis_6671.conf
cd /usr/local/redis/conf/
chmod 0777 redis_6666.conf redis_6667.conf redis_6668.conf redis_6669.conf redis_6670.conf redis_6671.conf
```
>3、修改配置文件(六个配置都要修改)
```shell
cd /usr/local/redis/
vim redis_6666.conf # redis_6667.conf redis_6668.conf redis_6669.conf redis_6670.conf redis_6671.conf 修改一样
```
- 修改
```c
port 6666
daemonize yes
pidfile /usr/local/redis/data/redis_6666.pid
timeout 300
loglevel verbose
logfile /usr/local/redis/logs/redis_6666.log
dbfilename dump_6666.rdb
dir /usr/local/redis/data/ 
appendonly yes
appendfilename appendonly_6666.aof
no-appendfsync-on-rewrite yes
auto-aof-rewrite-percentage 80-100
bind 192.168.59.136 # 服务器ip
```
- 添加

```c
unixsocket /usr/local/redis/data/redis_6666.sock
unixsocketperm 700
cluster-enabled yes
cluster-config-file /usr/local/redis/data/nodes_6666.conf 
cluster-node-timeout 5000 
```

>启动
```shell
cd /usr/local/redis/perform/bin/
./redis-server /usr/local/redis/conf/redis_6666.conf 
./redis-server /usr/local/redis/conf/redis_6667.conf
./redis-server /usr/local/redis/conf/redis_6668.conf
./redis-server /usr/local/redis/conf/redis_6669.conf
./redis-server /usr/local/redis/conf/redis_6670.conf
./redis-server /usr/local/redis/conf/redis_6671.conf
```
- 关闭redis
```shell
ps -ef|grep redis
kill -9 xxxx #可以多个
```
>创建集群
```shell
cd /usr/local/redis/perform/src
./redis-cli --cluster create 192.168.59.136:6666 192.168.59.136:6667 192.168.59.136:6668 192.168.59.136:6669 192.168.59.136:6670 192.168.59.136:6671
```

>开启防火墙
```shell
vim /etc/sysconfig/iptables
```

```shell
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6666 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6667 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6668 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6669 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6670 -j ACCEPT
-A INPUT -m state --state NEW -m tcp -p tcp --dport 6671 -j ACCEPT

```

```shell
service iptables restart #重启
```

# 测试

```shell
redis-cli -h 192.168.59.136 -p 6666

set myKey abc

get myKey
```
