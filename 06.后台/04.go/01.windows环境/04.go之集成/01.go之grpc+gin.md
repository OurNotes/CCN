总操作流程：
- 1、[单独测试成功](#go-01)
- 2、[集成](#go-02)
- 3、[测试](#go-03)


***

# <a name="go-01" href="#" >单独测试成功</a>

> 单独测试gin

[![](https://img.shields.io/badge/参考文献-gin之快速开始-yellow.svg "参考文献 gin之快速开始")](https://github.com/OurNotes/CCN/blob/master/6.%E5%90%8E%E5%8F%B0/4.go/01.windows%E7%8E%AF%E5%A2%83/02.go%E4%B9%8B%E6%A1%86%E6%9E%B6/01.go%E4%B9%8Bgin/01.gin%E4%B9%8B%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B.md)

> 单独测试成功grpc

[![](https://img.shields.io/badge/参考文献-go--grpc之SimpleRPC(简单rpc)-yellow.svg "参考文献 go-grpc之SimpleRPC(简单rpc)")](https://github.com/OurNotes/CCN/blob/master/6.%E5%90%8E%E5%8F%B0/4.go/01.windows%E7%8E%AF%E5%A2%83/02.go%E4%B9%8B%E6%A1%86%E6%9E%B6/02.go%E4%B9%8Bgrpc/01.go-grpc%E4%B9%8BSimple%20RPC(%E7%AE%80%E5%8D%95rpc).md)

# <a name="go-02" href="#" >集成</a>

> 项目目录

![](image/1-1.png)

> greeter.proto

<details>
<summary>代码</summary>

```go
syntax = "proto3";

package proto;

service SearchService {
    rpc Search(SearchRequest) returns (SearchResponse) {}
}

message SearchRequest {
    string request = 1;
}

message SearchResponse {
    string response = 1;
}
```

</details>

- 编译

```js
# 进入proto目录下，在shell输入命令

cd proto

protoc -I . greeter.proto --go_out=plugins=grpc:.
```

> router.go

<details>
<summary>代码</summary>

```go

package routers
 
import (
    "github.com/gin-gonic/gin"
    . "test/routers/api"
)
 
func InitRouter() *gin.Engine {
    router := gin.Default()
 
    router.GET("/test", Test)
 
    return router
}
```

</details>


> test.go

<details>
<summary>代码</summary>

```go

package api

import (
	"log"
	"context"
	"net/http"
	"github.com/gin-gonic/gin"
	proto "test/proto"
	"google.golang.org/grpc"
)

const PORT = "8080"


func Test(c *gin.Context) {
	//创建与给定目标（服务端）的连接交互
	conn, err := grpc.Dial(":"+PORT, grpc.WithInsecure())
	if err != nil {
		log.Fatalf("grpc.Dial err: %v", err)
		return
	}
	defer conn.Close()
	//创建 SearchService 的客户端对象
	client := proto.NewSearchServiceClient(conn)

	resp, err := client.Search(context.Background(), &proto.SearchRequest{
		Request: "gRPC",
	})
	if err != nil {
		log.Fatalf("client.Search err: %v", err)
		c.JSON(http.StatusOK, gin.H{                                                 
            "code":    -1,
            "message": "抱歉未找到相关信息",
        })
        return
	}

	c.JSON(200, gin.H{
		"result": resp.GetResponse(),
	})
}


```

</details>

> register.go

<details>
<summary>代码</summary>

```go
package srv_comic
 
import (
	"context"
	"google.golang.org/grpc"
	proto "test/proto"
 
)

type SearchService struct{}

func (s *SearchService) Search(ctx context.Context, r *proto.SearchRequest) (*proto.SearchResponse, error) {
	return &proto.SearchResponse{Response: r.GetRequest() + " Server"}, nil
}

func ServiceReg(server *grpc.Server)  {
	proto.RegisterSearchServiceServer(server,&SearchService{})

}

```

</details>

> server.go

<details>
<summary>代码</summary>

```go
package main
 
import (
	"log"
	"net"
	"google.golang.org/grpc"
	"google.golang.org/grpc/reflection"
	service "test/service/register"
)


const PORT = "8080"

func main() {
	//创建 Listen，监听 TCP 端口
	lis, err := net.Listen("tcp", ":"+PORT)
	if err != nil {
		log.Fatalf("net.Listen err: %v", err)
	}
	//创建 gRPC Server 对象
	server := grpc.NewServer()
	//将 SearchService注册到 gRPC Server 的内部注册中心
	service.ServiceReg(server)
	// Register reflection service on gRPC server.
	reflection.Register(server)
	if err := server.Serve(lis); err != nil {
		log.Fatalf("failed to serve: %v", err)
	}
}
```

</details>

> main.go

<details>
<summary>代码</summary>

```go
package main

import (
	"log"
	"test/routers"
)

const PORT = "8080"

func main() {

	
	router := routers.InitRouter()
	// 启动并监听8089端口
	if err := router.Run(":8089"); err != nil {
		log.Fatalf("could not run server: %v", err)
	}

}


```

</details>

# <a name="go-03" href="#" >测试</a>

> 先运行grpc

```
set GO111MODULE=on
set GOPROXY=https://goproxy.io

go mod init test
go mod tidy

go run service/server.go
```

> 再运行gin

```
go run main.go
```


> 最后使用postman测试接口

```
http://localhost:8089/ping
```

![](image/1-2.png)
