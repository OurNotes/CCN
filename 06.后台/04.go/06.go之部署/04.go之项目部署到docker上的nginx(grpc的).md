总操作流程：
- 1、[下载安装](#go-01)
- 2、[配置](#go-02)
- 3、[测试](#go-03)

***

# <a name="go-01" href="#" >下载安装</a>

> 下拉mysql

```shell
docker pull mysql:8.0.18
# 创建容器
docker run --privileged=true --name test_mysql -v /usr/mysql:/var/lib/mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:8.0.18
```

> 下拉nginx

```shell
docker pull nginx:latest

# 创建容器
docker run --name nginx -p 81:80 -d nginx
```

> 防火墙开放端口

```
firewall-cmd --permanent --zone=public --add-port=3306/tcp
firewall-cmd --permanent --zone=public --add-port=81/tcp
firewall-cmd --reload
```

# <a name="go-02" href="#" >配置</a>

> 配置mysql

- 进入容器中: docker exec -it test_mysql /bin/bash  
- 连接mysql: mysql -u root -p
- 配置mysql:

<details>
<summary>mysql命令</summary>

```sql
CREATE USER 'test_mysql'@'%' IDENTIFIED BY '123456';
flush privileges;

-- 创建数据库
create database test;
GRANT all privileges ON test.* TO 'test_mysql'@'%' WITH GRANT OPTION;
flush privileges; 

-- 修改加密规则
ALTER USER 'test_mysql'@'%' IDENTIFIED BY '123456' PASSWORD EXPIRE NEVER;

-- 更新一下用户的密码 
ALTER USER 'test_mysql'@'%' IDENTIFIED WITH mysql_native_password BY '123456';
FLUSH PRIVILEGES;

-- 再重置下密码
alter user 'test_mysql'@'%' identified by '123456';
FLUSH PRIVILEGES;

use test;

CREATE table tests(
	id INT(11) primary key not null auto_increment,
	name VARCHAR(25),
	age int,
	birthday date
);

INSERT into tests VALUES (1,"张三",15,'2020-05-03');
INSERT into tests VALUES (2,"李四",15,'2020-04-03');
INSERT into tests VALUES (3,"李光",15,'2020-03-03');

quit;
```

</details>

- 按快捷键退出容器：<kbd>Ctrl</kbd>+<kbd>D</kbd>

> 配置nginx

```shell
# 创建文件
docker exec -it nginx /bin/bash

mkdir -p /etc/go
mkdir -p /etc/go/conf
mkdir -p /etc/logs

chmod 777 /etc/go
chmod 777 /etc/go/conf
chmod 777 /etc/logs

cd /etc/logs

touch error.log
touch access.log

chmod 777 error.log
chmod 777 access.log
```

- 按快捷键退出容器：<kbd>Ctrl</kbd>+<kbd>D</kbd>

```shell
# 修改nginx配置
docker cp nginx:/etc/nginx/conf.d/default.conf /
```

```js
server {
        listen       80;
        server_name  localhost;

        charset utf-8;
        access_log  /etc/logs/access.log;

        location ~ \.(css|js|fonts|png|svg|html|txt)$ {
            access_log on;
            expires 1d;
            
            root "/etc/go";
            try_files $uri @backend;
        }

        location / {
            try_files /_not_exists_ @backend;
        }

        location @backend {
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_set_header Host            $http_host;
            proxy_pass http://127.0.0.1:8089;
        }
    }
```

```
docker stop nginx
docker start nginx

# 将修改好的配置文件复制回去
docker cp /default.conf nginx:/etc/nginx/conf.d
```



> 上传代码

- 打包[gorm+go-ini+grpc+gin+go-swagger](https://github.com/OurNotes/CCN/blob/master/06.%E5%90%8E%E5%8F%B0/04.go/04.go%E4%B9%8B%E9%9B%86%E6%88%90/04.go%E4%B9%8Bgorm%2Bgo-ini%2Bgrpc%2Bgin%2Bgo-swagger.md)这个项目

```shell
# vs code终端输入命令
set GOOS=linux
set GOARCH=amd64
go build service/server.go
go build main.go
```

```shell
# 将项目的打包的main、server文件和项目conf/conf.ini文件上传
cd /

docker cp /server nginx:/etc/go
docker cp /main nginx:/etc/go
docker cp /conf.ini nginx:/etc/go/conf
cd /etc/go

chmod 777 server
chmod 777 main
chmod 777 conf/conf.ini
```

# <a name="go-03" href="#" >测试</a>

> 运行开启两个窗口

- 1、
```
docker exec -it nginx /bin/bash
nohup ./server>server_log.txt &
```

- 2、
```
docker exec -it nginx /bin/bash
nohup ./main>main_log.txt &
```

> 使用postman测试接口：http://192.168.42.128:81/test