总操作流程：
- 1、[下载](#docker-01)
- 2、[配置](#docker-02)
- 3、[测试](#docker-03)

***

# <a name="docker-01" href="#" >下载</a>

```shell
docker pull redis:latest

# 创建虚拟网卡
docker network create redis-net
# 查看redis-net虚拟网卡网关ip
docker network inspect redis-net | grep "Gateway" | grep --color=auto -P '(\d{1,3}.){3}\d{1,3}' -o
```

# <a name="docker-02" href="#" >配置</a>

> 创建redis配置文件

```shell
mkdir -p /usr/local/redis-cluster
cd /usr/local/redis-cluster
touch redis-cluster.tmpl
chmod 0777 redis-cluster.tmpl
vim redis-cluster.tmpl
```

```shell
port ${PORT}
protected-mode no
cluster-enabled yes
pidfile  /var/run/redis_${PORT}.pid 
cluster-config-file nodes_${PORT}.conf
cluster-node-timeout 15000
cluster-announce-port ${PORT}
cluster-announce-bus-port 1${PORT}
appendonly yes
```

> 创建文件夹和文件

```shell

# 生成conf、data文件夹和配置信息
for port in `seq 6666 6671`; do \
  mkdir -p ./${port}/conf \
  && PORT=${port} envsubst < ./redis-cluster.tmpl > ./${port}/conf/redis.conf \
  && mkdir -p ./${port}/data \
  && chmod 777 ./${port}/conf/redis.conf; \
done
```
> 创建redis容器

```shell
for port in `seq 6666 6671`; do \
  docker run -d -ti -p ${port}:${port} -p 1${port}:1${port} \
  -v /usr/local/redis-cluster/${port}/conf/redis.conf:/etc/redis/redis.conf:rw \
  --restart always --name redis-${port} --net redis-net \
  --sysctl net.core.somaxconn=1024 redis redis-server /etc/redis/redis.conf; \
done
```

> 防火墙开放端口

```shell
for port in `seq 6666 6671`; do \
   firewall-cmd --permanent --zone=public --add-port=${port}/tcp; \
   firewall-cmd --permanent --zone=public --add-port=1${port}/tcp; \
done 
firewall-cmd --reload
```

> 启动

```
docker run -it --net redis-net \
               --rm redis redis-cli \
               --cluster create 192.168.42.128:6666 \
                                192.168.42.128:6667 \
                                192.168.42.128:6668 \
                                192.168.42.128:6669 \
                                192.168.42.128:6670 \
                                192.168.42.128:6671 \
               --cluster-replicas 1;
```

- 注意出现提问：Can I set the above configuration? (type 'yes' to accept): 输入：yes

# <a name="docker-03" href="#" >测试</a>

> 测试

```
docker run -it --link redis-6670:redis --net redis-net --rm redis redis-cli -h 192.168.42.128 -c -p 6670

set myKey abc

GET myKey
```

> 测试


- 也可以使用软件链接测试

[![](https://img.shields.io/badge/百度云-RedisDesktopManager-green.svg "百度云 RedisDesktopManager")](https://pan.baidu.com/s/1b1lGG7umXfaB4dxk8sVpBQ)

提取码：4pmw
